import React, { useState, useEffect } from 'react';

interface FullscreenButtonProps {
  onLog?: (message: string) => void;
}

const FullscreenButton: React.FC<FullscreenButtonProps> = ({ onLog }) => {
  const [isFullscreen, setIsFullscreen] = useState(false);
  const [fullscreenSupported, setFullscreenSupported] = useState(false);

  useEffect(() => {
    const logMessage = 'ğŸ” FullscreenButton useEffect - Ğ¸Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ';
    console.log(logMessage);
    onLog?.(logMessage);
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºÑƒ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°
    const checkFullscreenSupport = () => {
      const supported = !!(
        document.fullscreenEnabled ||
        (document as any).webkitFullscreenEnabled ||
        (document as any).mozFullScreenEnabled ||
        (document as any).msFullscreenEnabled
      );
      setFullscreenSupported(supported);
      
      const supportLog = `ğŸ“± ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Fullscreen API: ${supported ? 'âœ…' : 'âŒ'}`;
      console.log(supportLog);
      onLog?.(supportLog);
      
      // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼ Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ
      const fullscreenElement = 
        document.fullscreenElement ||
        (document as any).webkitFullscreenElement ||
        (document as any).mozFullScreenElement ||
        (document as any).msFullscreenElement;
      
      setIsFullscreen(!!fullscreenElement);
      
      const stateLog = `ğŸ–¥ï¸ Ğ¢ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Fullscreen: ${!!fullscreenElement ? 'âœ…' : 'âŒ'}`;
      console.log(stateLog);
      onLog?.(stateLog);
    };

    checkFullscreenSupport();

    // Ğ¡Ğ»ÑƒÑˆĞ°ĞµĞ¼ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°
    const handleFullscreenChange = () => {
      const fullscreenElement = 
        document.fullscreenElement ||
        (document as any).webkitFullscreenElement ||
        (document as any).mozFullScreenElement ||
        (document as any).msFullscreenElement;
      
      const newState = !!fullscreenElement;
      setIsFullscreen(newState);
      
      const changeLog = `ğŸ”„ Ğ˜Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğµ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Fullscreen: ${newState ? 'âœ…' : 'âŒ'}`;
      console.log(changeLog);
      onLog?.(changeLog);
    };

    document.addEventListener('fullscreenchange', handleFullscreenChange);
    document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
    document.addEventListener('mozfullscreenchange', handleFullscreenChange);
    document.addEventListener('MSFullscreenChange', handleFullscreenChange);

    const listenersLog = 'âœ… Ğ¡Ğ»ÑƒÑˆĞ°Ñ‚ĞµĞ»Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Fullscreen Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ñ‹';
    console.log(listenersLog);
    onLog?.(listenersLog);

    return () => {
      document.removeEventListener('fullscreenchange', handleFullscreenChange);
      document.removeEventListener('webkitfullscreenchange', handleFullscreenChange);
      document.removeEventListener('mozfullscreenchange', handleFullscreenChange);
      document.removeEventListener('MSFullscreenChange', handleFullscreenChange);
      
      const cleanupLog = 'ğŸ§¹ Ğ¡Ğ»ÑƒÑˆĞ°Ñ‚ĞµĞ»Ğ¸ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ğ¹ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ğ¾Ğ³Ğ¾ Fullscreen ÑƒĞ´Ğ°Ğ»ĞµĞ½Ñ‹';
      console.log(cleanupLog);
      onLog?.(cleanupLog);
    };
  }, [onLog]);

  const requestFullscreen = async () => {
    try {
      const element = document.documentElement;
      
      const requestLog = 'ğŸ–¼ï¸ Ğ—Ğ°Ğ¿Ñ€Ğ°ÑˆĞ¸Ğ²Ğ°ĞµĞ¼ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼...';
      console.log(requestLog);
      onLog?.(requestLog);
      
      if (element.requestFullscreen) {
        await element.requestFullscreen();
      } else if ((element as any).webkitRequestFullscreen) {
        await (element as any).webkitRequestFullscreen();
      } else if ((element as any).mozRequestFullScreen) {
        await (element as any).mozRequestFullScreen();
      } else if ((element as any).msRequestFullscreen) {
        await (element as any).msRequestFullscreen();
      }
      
      const successLog = 'âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½!';
      console.log(successLog);
      onLog?.(successLog);
    } catch (error) {
      const errorLog = `âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°: ${error}`;
      console.error(errorLog);
      onLog?.(errorLog);
    }
  };

  const exitFullscreen = async () => {
    try {
      const exitLog = 'ğŸ–¼ï¸ Ğ’Ñ‹Ñ…Ğ¾Ğ´Ğ¸Ğ¼ Ğ¸Ğ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°...';
      console.log(exitLog);
      onLog?.(exitLog);
      
      if (document.exitFullscreen) {
        await document.exitFullscreen();
      } else if ((document as any).webkitExitFullscreen) {
        await (document as any).webkitExitFullscreen();
      } else if ((document as any).mozCancelFullScreen) {
        await (document as any).mozCancelFullScreen();
      } else if ((document as any).msExitFullscreen) {
        await (document as any).msExitFullscreen();
      }
      
      const successLog = 'âœ… ĞŸĞ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½!';
      console.log(successLog);
      onLog?.(successLog);
    } catch (error) {
      const errorLog = `âŒ ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°: ${error}`;
      console.error(errorLog);
      onLog?.(errorLog);
    }
  };

  const toggleFullscreen = () => {
    const toggleLog = `ğŸ”˜ FullscreenButton toggleFullscreen Ğ²Ñ‹Ğ·Ğ²Ğ°Ğ½Ğ°, Ñ‚ĞµĞºÑƒÑ‰ĞµĞµ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ğµ: ${isFullscreen ? 'âœ…' : 'âŒ'}`;
    console.log(toggleLog);
    onLog?.(toggleLog);
    
    // ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµĞ¼, Ğ½Ğ°Ñ…Ğ¾Ğ´Ğ¸Ğ¼ÑÑ Ğ»Ğ¸ Ğ¼Ñ‹ Ğ² Telegram
    if (window.Telegram?.WebApp) {
      const webApp = window.Telegram.WebApp;
      const telegramLog = 'ğŸ“± Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Telegram WebApp API';
      console.log(telegramLog);
      onLog?.(telegramLog);
      
      if (!webApp.isExpanded) {
        // Ğ Ğ°ÑÑˆĞ¸Ñ€ÑĞµĞ¼ Ğ² Telegram
        const expandLog = 'ğŸ–¼ï¸ Ğ’Ñ‹Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ webApp.expand()';
        console.log(expandLog);
        onLog?.(expandLog);
        webApp.expand();
      } else {
        // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ¸Ğ· Telegram
        const exitLog = 'ğŸ“± ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ´Ğ»Ñ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ¸Ğ· Telegram';
        console.log(exitLog);
        onLog?.(exitLog);
        webApp.showAlert('ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ "ĞĞ°Ğ·Ğ°Ğ´" Ğ² Telegram Ğ´Ğ»Ñ Ğ²Ñ‹Ñ…Ğ¾Ğ´Ğ° Ğ¸Ğ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°');
      }
    } else {
      // Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ñ‹Ğ¹ Fullscreen API
      const browserLog = 'ğŸ–¥ï¸ Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµĞ¼ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ½Ñ‹Ğ¹ Fullscreen API';
      console.log(browserLog);
      onLog?.(browserLog);
      
      if (isFullscreen) {
        exitFullscreen();
      } else {
        requestFullscreen();
      }
    }
  };

  // Ğ¡ĞºÑ€Ñ‹Ğ²Ğ°ĞµĞ¼ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ, ĞµÑĞ»Ğ¸ Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ğ´ĞµÑ€Ğ¶Ğ¸Ğ²Ğ°ĞµÑ‚ÑÑ
  // if (!fullscreenSupported) {
  //   return null;
  // }

  // ĞĞ¿Ñ€ĞµĞ´ĞµĞ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ·Ğ¸Ñ†Ğ¸Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¸
  const getButtonPosition = () => {
    return "fixed bottom-6 right-6 z-[9999]";
  };

  return (
    <div className={`${getButtonPosition()} flex flex-col items-center gap-2`}>
      {/* Ğ‘Ğ¾Ğ»ÑŒÑˆĞ°Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ° Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ° */}
      <button
        onClick={toggleFullscreen}
        className="w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 backdrop-blur-xl border-2 border-white/80 rounded-2xl shadow-2xl shadow-black/20 hover:shadow-2xl hover:shadow-black/30 transition-all duration-300 transform hover:scale-110 group"
        aria-label={isFullscreen ? "Ğ’Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°" : "ĞŸĞ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼"}
        title={isFullscreen ? "Ğ’Ñ‹Ğ¹Ñ‚Ğ¸ Ğ¸Ğ· Ğ¿Ğ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ€ĞµĞ¶Ğ¸Ğ¼Ğ°" : "ĞŸĞ¾Ğ»Ğ½Ğ¾ÑĞºÑ€Ğ°Ğ½Ğ½Ñ‹Ğ¹ Ñ€ĞµĞ¶Ğ¸Ğ¼"}
      >
        <div className="flex items-center justify-center w-full h-full">
          {isFullscreen ? (
            <svg 
              className="w-8 h-8 text-white group-hover:text-yellow-200 transition-colors duration-300" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                strokeWidth={2.5} 
                d="M9 9V4.5M9 9H4.5M9 9L3.75 3.75M9 15v4.5M9 15H4.5M9 15l-5.25 5.25M15 9h4.5M15 9V4.5M15 9l5.25-5.25M15 15h4.5M15 15v4.5m0-4.5l5.25 5.25" 
              />
            </svg>
          ) : (
            <svg 
              className="w-8 h-8 text-white group-hover:text-yellow-200 transition-colors duration-300" 
              fill="none" 
              stroke="currentColor" 
              viewBox="0 0 24 24"
            >
              <path 
                strokeLinecap="round" 
                strokeLinejoin="round" 
                strokeWidth={2.5} 
                d="M3.75 3.75v4.5m0-4.5h4.5m-4.5 0l5.25 5.25M20.25 3.75h-4.5m4.5 0v4.5m0-4.5L15 9m5.25 11.25h-4.5m4.5 0v-4.5m0 4.5L15 15m-11.25 5.25h4.5m-4.5 0v-4.5m0 4.5L9 15" 
              />
            </svg>
          )}
        </div>
        
        {/* Hover effect */}
        <div className="absolute inset-0 rounded-2xl bg-gradient-to-r from-yellow-400/20 to-orange-400/20 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
        
        {/* Glow effect */}
        <div className="absolute inset-0 rounded-2xl bg-gradient-to-r from-yellow-400/10 to-orange-400/10 blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
      </button>

      {/* ĞÑ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ */}
      <div className="bg-black/90 backdrop-blur-xl border border-white/20 rounded-xl p-3 text-white text-xs max-w-48">
        <div className="font-bold mb-2">ğŸ” ĞÑ‚Ğ»Ğ°Ğ´ĞºĞ° Fullscreen</div>
        <div className="space-y-1">
          <div>ğŸ–¥ï¸ isFullscreen: {isFullscreen ? 'âœ…' : 'âŒ'}</div>
          <div>ğŸ“± ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°: {fullscreenSupported ? 'âœ…' : 'âŒ'}</div>
          <div>ğŸ“± Telegram WebApp: {window.Telegram?.WebApp ? 'âœ…' : 'âŒ'}</div>
          <div>ğŸ“± Telegram isExpanded: {window.Telegram?.WebApp?.isExpanded ? 'âœ…' : 'âŒ'}</div>
          <div>ğŸ“ viewportHeight: {window.Telegram?.WebApp?.viewportHeight || 'N/A'}</div>
          <div>ğŸ“ viewportStableHeight: {window.Telegram?.WebApp?.viewportStableHeight || 'N/A'}</div>
          <div>ğŸŒ platform: {window.Telegram?.WebApp?.platform || 'N/A'}</div>
          <div>ğŸ”§ document.fullscreenEnabled: {document.fullscreenEnabled ? 'âœ…' : 'âŒ'}</div>
          <div>ğŸ”§ webkitFullscreenEnabled: {(document as any).webkitFullscreenEnabled ? 'âœ…' : 'âŒ'}</div>
        </div>
        
        {/* ĞšĞ½Ğ¾Ğ¿ĞºĞ° ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ */}
        <button
          onClick={() => {
            const debugInfo = [
              `ğŸ” Fullscreen Debug Info - ${new Date().toLocaleTimeString()}`,
              `ğŸ–¥ï¸ isFullscreen: ${isFullscreen}`,
              `ğŸ“± ĞŸĞ¾Ğ´Ğ´ĞµÑ€Ğ¶ĞºĞ° Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°: ${fullscreenSupported}`,
              `ğŸ“± Telegram WebApp: ${window.Telegram?.WebApp ? 'âœ…' : 'âŒ'}`,
              `ğŸ“± Telegram isExpanded: ${window.Telegram?.WebApp?.isExpanded ? 'âœ…' : 'âŒ'}`,
              `ğŸ“ viewportHeight: ${window.Telegram?.WebApp?.viewportHeight || 'N/A'}`,
              `ğŸ“ viewportStableHeight: ${window.Telegram?.WebApp?.viewportStableHeight || 'N/A'}`,
              `ğŸŒ platform: ${window.Telegram?.WebApp?.platform || 'N/A'}`,
              `ğŸ”§ webApp.version: ${window.Telegram?.WebApp?.version || 'N/A'}`,
              `ğŸ¨ webApp.colorScheme: ${window.Telegram?.WebApp?.colorScheme || 'N/A'}`,
              `ğŸ”§ document.fullscreenEnabled: ${document.fullscreenEnabled ? 'âœ…' : 'âŒ'}`,
              `ğŸ”§ webkitFullscreenEnabled: ${(document as any).webkitFullscreenEnabled ? 'âœ…' : 'âŒ'}`
            ].join('\n');
            
            navigator.clipboard.writeText(debugInfo).then(() => {
              onLog?.('ğŸ“‹ ĞÑ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ğ°Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ°');
            }).catch(() => {
              onLog?.('âŒ ĞÑˆĞ¸Ğ±ĞºĞ° ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´Ğ¾Ñ‡Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸');
            });
          }}
          className="mt-2 w-full px-2 py-1 bg-green-500/80 text-white text-xs rounded-lg hover:bg-green-500 transition-colors"
        >
          ğŸ“‹ ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºÑƒ
        </button>
      </div>
    </div>
  );
};

export default FullscreenButton; 